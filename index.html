function doPost(e) {
  try {
    // Ambil data dari form-encoded (URLSearchParams)
    const imageBase64 = e.parameter.image;  // Data foto dalam base64
    const lat = e.parameter.lat;
    const lng = e.parameter.lng;
    const address = e.parameter.address || '';
    const timestamp = e.parameter.timestamp || new Date().toISOString();
    const user = e.parameter.user || 'anonymous';

    // Ambil file foto dan simpan ke Google Drive
    const folder = DriveApp.getFolderById('18SzxY6cs_sL1Y2vVcQDPC-OXPeiXK1Fo'); // Ganti ID folder
    const contentType = 'image/jpeg';
    const bytes = Utilities.base64Decode(imageBase64.replace(/^data:image\/\w+;base64,/, ''));
    const blob = Utilities.newBlob(bytes, contentType, `photo_${timestamp}.jpg`);
    const file = folder.createFile(blob);

    // Simpan metadata di Spreadsheet
    const sheet = SpreadsheetApp.openById('1mFwO2GqU4ZAdRUB9vOiovC49jCF2vym0bCS-Or4JcZI').getSheetByName('Sheet1');
    sheet.appendRow([new Date(), user, lat, lng, address, file.getUrl()]);

    // Respon ke frontend
    return ContentService
      .createTextOutput(JSON.stringify({ status: 'ok', fileUrl: file.getUrl() }))
      .setMimeType(ContentService.MimeType.JSON)
      .setHeader('Access-Control-Allow-Origin', '*');

  } catch (err) {
    return ContentService
      .createTextOutput(JSON.stringify({ status: 'error', message: err.toString() }))
      .setMimeType(ContentService.MimeType.JSON)
      .setHeader('Access-Control-Allow-Origin', '*');
  }
}