function doPost(e) {
  try {
    // Ambil data dari form-encoded (URLSearchParams)
    const imageBase64 = e.parameter.image;  // Data foto dalam base64
    const lat = e.parameter.lat;
    const lng = e.parameter.lng;
    const address = e.parameter.address || '';
    const timestamp = e.parameter.timestamp || new Date().toISOString();
    const user = e.parameter.user || 'anonymous';
    
    // Ambil folder Google Drive berdasarkan ID folder yang benar
    const folder = DriveApp.getFolderById('18SzxY6cs_sL1Y2vVcQDPC-OXPeiXK1Fo'); // Ganti dengan ID folder kamu
    
    // Decode base64 image
    const contentType = 'image/jpeg';
    const bytes = Utilities.base64Decode(imageBase64.replace(/^data:image\/\w+;base64,/, ''));
    const blob = Utilities.newBlob(bytes, contentType, `photo_${timestamp}.jpg`);
    
    // Simpan file ke Drive
    const file = folder.createFile(blob);
    
    // Buka spreadsheet dan sheet berdasarkan ID yang benar
    const sheet = SpreadsheetApp.openById('1mFwO2GqU4ZAdRUB9vOiovC49jCF2vym0bCS-Or4JcZI').getSheetByName('Sheet1');
    
    // Simpan metadata ke sheet
    sheet.appendRow([new Date(), user, lat, lng, address, file.getUrl()]);
    
    // Balikan response sukses (tanpa setHeader)
    return ContentService
      .createTextOutput(JSON.stringify({ status: 'ok', fileUrl: file.getUrl() }))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (err) {
    return ContentService
      .createTextOutput(JSON.stringify({ status: 'error', message: err.toString() }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}